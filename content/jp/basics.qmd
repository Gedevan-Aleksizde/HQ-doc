# 基本

```{r}
#| label: setup

source(here::here("script/common.R"))
```

## 操作に関する基本事項

### 移動

操作は鉄拳と似ている. つまり, 左右キーが前進・後退, 上下キーが奥・手前移動で, ジャンプはできない.

2024.07.09 時点では, 移動処理が少し変である. 頻繁にコマンドの暴発が発生していることから, どうも十字キーの入力が相手との相対的な方向で判定されている気がする. 加えて, 相手キャラクターへの自動追従も時々おかしくなり, 普通に入力しても殆どの場合であさっての方向へ繰り出されほぼ命中しない「ハズレ技」とそうでない攻撃に分かれている気がする. 開発者の意図した動きなのか, バグなのかは不明だが, 前者だとしたら相当難易度が高くなるので, 私は物理エンジンの更新が影響しているのではないかと疑っている.


### 攻撃

攻撃操作も鉄拳と似ている. デフォルトでは, `r reuse_svg(file.path("../../../../img/key", "TYGH.svg"))` を使用する. ゲームパッドなら, XBOX, PS でそれぞれ `r reuse_svg(file.path("../../../../img/xbox", "TYGH.svg"))` `r reuse_svg(file.path("../../../../img/ps", "TYGH.svg"))` に対応する. 4つのボタンは四方向からの攻撃におおむね対応している. `r reuse_svg(file.path("../../../../img/xbox", c("T.svg", "Y.svg")))` は左右の斬り下ろし攻撃で, `r reuse_svg(file.path("../../../../img/xbox", c("G.svg", "H.svg")))` は左右の斬り上げまたは下段攻撃になり, キーボードのデフォルト設定も隣接する4つのキー `r knitr::asis_output(paste(readLines(here::here("img/4keys.svg")), collapse=""))` がこれに対応する. ほとんどの基本攻撃は対角線を描くようになされる.

![基本攻撃 (Meyer 風の表現)](/img/square.png)

ほとんどの場合, 移動しながら攻撃ボタンを押すと, 足を止めて攻撃する場合と異なる動作となる. しかし, このことは後述のコマンド表に書かれていない.


### 攻撃の方向

TODO

現代フェンシングでは quarte, sixte, octave, septime の四方向なのでHQとも合っているが, quart と方向が全く違うのでややこしいか?


### パリィ

HQでは, 自動防御でパリィができる. やはり鉄拳と同様に, コマンド攻撃をしていない状態であれば, 相手の攻撃に合わせて自動的に防御姿勢を取るようになっている. 移動ボタンを押していても, 攻撃さえしていなければ自動防御は発動している. 自動防御の姿勢はキャラクターごとに決まっているため, 攻撃の太刀筋やお互いの位置取りによっては, 防御をすり抜けてしまうことがあるため, 絶対ではない. 特に, ほとんどのキャラクターは, 突き攻撃に対する自動防御に隙がある.

防御判定はリアルタイムの物理演算によってなされるため, 剣の重さなども考慮され, 条件によっては攻撃を受けても力負けして押し込まれることもある. よって, 至近距離で刃の先端近くで受けるより, 離れて刃の根本で受けたほうが力負けしにくくなるため, 防御も成功しやすい. 剣を強く弾かれたときは, 通常よりも大きな効果音が鳴る.


### リポスト

パリィしてすぐに攻撃ボタンを押すと, リポストになる. 一部のキャラクターや攻撃ボタンには, リポスト時により速く反撃できる補正がつくものがある.


### カウンター

hQではリアルタイムで当たり判定が計算されるため, 相手の攻撃に対してこちらも攻撃を重ねることで防御の代わりになることがある. 更に, 物理演算の結果によっては, どちらかが押し負けて攻撃が届くことがある.


### コマンド

格闘ゲームによくある, 十字キー+攻撃ボタンのようなコマンドは少なく, ほとんどのコマンドは順番にタイミングよく押すことで発動する.

攻撃の中には, いくつか特殊なものがある.

* フェイントで相手の構えを変える「威嚇」
* 相手を掴み, 成功すると必ず相手を倒せる「掴み」
    * 掴みに対する投げ抜け操作はレバガチャではなく後退ボタンである
* 相手を押して構えを崩す「押しのけ」
* 突き攻撃に対処し, 使用可能なコマンドも変える「ロングガード」の姿勢

がある. ゲームパッドでは, これらはバンパー・トリガーキーで入力できる. しかし,  2024.07.07 時点では **ゲーム内のコマンド表がめちゃくちゃ間違っている**.

* RBが威嚇
* RTが押しのけ
* LBが掴み
* LTがロングガード

である.


### ロングガード

ほとんどのキャラクターにはロングガードという通常とは異なる構えがある. この構えでは, 剣の先端を相手に向け, 腕を伸ばした姿勢になる. ロングガードの持続中は, 使用できるコマンドが変化し, なおかつ突き攻撃に対する自動防御が強化される. 一方で, 斬撃に対して自動防御が発生しなくなり, 斬撃によって剣を叩かれると姿勢を崩しやすくなる.

レイピアを使用するキャラクターは, 普段から剣を水平に構えているので, 通常の構えとロングガードの性質が逆転している.


### フェイント

自動防御を無力化する「フェイント技」がいくつか存在する. 誤った方向に自動防御を誘発させるような技で, コマンド表で「フェイント」と書かれているものが該当する. 名前にフェイントとついていても, フェイント効果がないものもある. 加えて「威嚇」コマンドは一瞬足踏みするだけで攻撃はしないが, 同様に相手の自動防御の向きを切り替えさせる効果がある.

これ以外にも, 変則的な動きで, 対人戦において相手プレイヤーの誤判断を誘いやすいコマンドや, 自動防御の隙間をぬって攻撃するようなコマンドがいくつかある. これらに自動防御を無効化する効果はないが, こういった技も広義のフェイント技とみなせる.


### キャンセル

攻撃してすぐに後退ボタンを押すと, 即座に攻撃動作をキャンセルして元の姿勢に戻れる. 全ての攻撃動作でできるわけではない.


### HP

HQではほとんどが一撃か数発の攻撃で勝敗が決するが, 処理の内部では体の部位ごとにHPが設定されている. いずれかの部位のHPがゼロになるか, 合計HPが一定以下になると負けになる. 頭部と利き腕が最もHPが少なく, 胴体や利き腕と反対の足はHPが高い. HPが高い部位へ攻撃を当てても, 一撃で勝敗がつかないことがある.

以下は非公式の検証動画である. 時間が経っているので, 細かい数値は変更されている可能性がある.

利き手にダメージを受けると攻撃速度が遅くなったり, 脚部にダメージを受けると, 移動速度に影響が出たり, ステップ移動ができなくなったりすることがある.

{{< video https://www.youtube.com/watch?v=gX3rL5pgt5E >}}


### スタミナ

キャラクターは攻撃やステップ移動を行うとスタミナを消費する. これらの行動を取らずにいると, スタミナは回復する. スタミナが50%未満になると, 動きが遅くなったり構えが乱れたりする. スタミナが底を突きそうな状態では, コマンドもまともに受け付けなくなる. スタミナが低下している状態では, 画面端が青く点滅する. スタミナの最大値は現在のHPに対応している.


### Right of Way

v.2021.10.29.0で追加されたルールを指す. いわゆるフェンシングの Phrase d'arme であり, 対戦モードなどで従来ルールと選択できる.

従来は相打ちは引き分けだったが, このルールでは「優先権」のあるどちらかのプレイヤーのみが得点できる. その優先権は, 以下のような条件で獲得したり喪失したりする.

* 先に一歩踏み出す, 立ち止まった時点で無効
* 相手を後退させる
* 攻撃が空振りする, または防御された場合は優先権が相手に移る
* 一方的に攻撃を当てた場合はこれらの判定はなされず, 従来通りの勝ち点になる

{{< video https://www.youtube.com/watch?v=tVR9lTHiMdw >}}

